FONTNAME_BASE:=	%%FONTNAME_BASE%%
FAMILY:=	%%FAMILY%%
MODULES_KANA:=	%%MODULES_KANA%%
MODULES_LATIN:=	%%MODULES_LATIN%%
ALTERNATIVE_BASE:=	%%ALTERNATIVE_BASE%%
MODULES_ALT:=	%%MODULES_ALT%%
ifdef MPLUS_FULLSET 
MODULES= $(MODULES_KANA) $(MODULES_ALT) $(MODULES_LATIN) kanji
else 
MODULES= $(MODULES_KANA) $(MODULES_ALT) $(MODULES_LATIN) 
endif

WEIGHT:=	%%WEIGHT%%

SCRIPTS=	set_bearings set_kernings set_fontnames set_ligatures set_vert_chars set_instructions
SCRIPTS+=	ligature01.fea

${FONTNAME_BASE}-${WEIGHT}.ttf: build-ttf.pe $(SCRIPTS)
	/usr/local/bin/fontforge -script build-ttf.pe $@ $(MODULES)

set_bearings: ../../../../svg.d/latin_proportional1/bearings
	perl ../../../../scripts/split-bearing.pl ${WEIGHT} $(MODULES) > $@

set_kernings: ../../../../svg.d/latin_proportional1/kernings
	perl ../../../../scripts/split-kerning.pl ${WEIGHT} $(MODULES) > $@

build-ttf.pe: ../../../../scripts/build-ttf.pe
	ln -s ../../../../scripts/build-ttf.pe $@

set_ligatures: ../../../../scripts/set_ligatures
	ln -s ../../../../scripts/set_ligatures $@

set_vert_chars: ../../../../svg.d/miscellaneous1/vbearings
	perl ../../../../scripts/split-vbearing.pl ${WEIGHT} $(MODULES) > $@

ligature01.fea: ../../../../scripts/ligature01.fea
	ln -s ../../../../scripts/ligature01.fea $@

set_instructions: ../../../../scripts/set_instructions
	ln -s ../../../../scripts/set_instructions $@

set_fontnames: ../../../../scripts/set_fontnames.tmpl
	sed 's/%Fnbase%/${FONTNAME_BASE}/;s/%Family%/${FAMILY}/g;s/%Weight%/${WEIGHT}/g' ../../../../scripts/set_fontnames.tmpl > $@

clean:
	rm -f *~ *.ttf build-ttf.pe tmp.sfd
	rm -f set_bearings set_kernings set_fontnames set_ligatures set_instructions *.fea
