FONTNAME_BASE:=	%%FONTNAME_BASE%%
FAMILY:=	%%FAMILY%%
MODULES_KANA:=	%%MODULES_KANA%%
MODULES_LATIN:=	%%MODULES_LATIN%%

WEIGHT:=	%%WEIGHT%%

SCRIPTS=	set_bearings set_kernings set_fontnames set_instructions
MODULES=	$(MODULES_KANA) $(MODULES_LATIN)

${FONTNAME_BASE}-${WEIGHT}.ttf: build-ttf.pe $(SCRIPTS)
	/usr/local/bin/fontforge -script build-ttf.pe $@ $(MODULES)

set_bearings: ../../../../svg.d/latin_proportional1/bearings
	perl ../../../../scripts/split-bearing.pl ${WEIGHT} $(MODULES) > $@

set_kernings: ../../../../svg.d/latin_proportional1/kernings
	perl ../../../../scripts/split-kerning.pl ${WEIGHT} $(MODULES) > $@

build-ttf.pe: ../../../../scripts/build-ttf.pe
	ln -s ../../../../scripts/build-ttf.pe $@

set_instructions: ../../../../scripts/set_instructions
	ln -s ../../../../scripts/set_instructions $@

set_fontnames: ../../../../scripts/set_fontnames.tmpl
	sed 's/%Fnbase%/${FONTNAME_BASE}/;s/%Family%/${FAMILY}/g;s/%Weight%/${WEIGHT}/g' ../../../../scripts/set_fontnames.tmpl > $@

clean:
	rm -f *~ *.ttf build-ttf.pe set_bearings set_kernings set_fontnames tmp.sfd
